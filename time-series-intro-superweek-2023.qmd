---
title: "Time-Series Analysis"
subtitle: "Important Concepts, Handy Techniques, and Some Cautionary Tales"
author: "Tim Wilson<br>Superweek 2023"
format:
  revealjs: 
    theme: [moon, includes/theme-mod.scss]
    footer: \@tgwilson | tim@gilliganondata.com
    transition: zoom
    parallax-background-image: images/bg-mallards.jpeg
    parallax-background-size: "2100px 900px"
    background-transition: fade
title-slide-attributes:
  data-background-image: images/saliris.jpeg
  data-background-size: cover
  data-background-opacity: "0.2"
execute:
  echo: false
  dev: "png"
editor: visual
---

# Let's think about time.

```{r setup}
source("includes/setup.R")
```

::: {.notes}
Time is a broad and deep topic
It can be both obvious and intuitive...and it can be deceptive

:::

## 

::: columns
::: {.column width="40%"}
[The Bowhead Whale Can Live for Up to 200 Years]{style="font-size: 1.8em; text-align: right;"}
:::

::: {.column width="60%"}
![DALL-E 2: "A bowhead whale with a long gray beard and spectacles, digital art"](images/whale-beard.png)
:::
:::

::: {.notes}
This session will be 40 minutes.
The worldwide life expectany is 73 years.
The bowhead whale can live for 200 years.
The duration of Yehoshua's intro feels infinite.


As I was thinking about time I started thinking about lifetimes.
Specifically...how long are lifetimes?
Humans live for 80 years give or take.
What lives longer?
The Bowhead Whale. So, to spice things up a little bit in our discussion today, I thought I'd pull together some images of bowhead whales.

What I'm going to attempt over the next 30 or so minutes is a whale-sized task.
1. First, we'll briefly consider why time matters so much
2. Second, we'll explore how time can make us see correlations where we're just seeing correlations with time rather than correlations between two metrics. And we'll look at how we can check for that.
3. Third, we'll talk about decomposing time. Don't worry, it doesn't smell! I realized this first blew my mind a few years ago, and I actually talked about it at Superweek over 5 years ago. It still blows my mind.
4. Finally, we'll look at Bayesian structural time-series, which, hopefully, will tie everything together.

Fundamentally, we are using data from the *past* to try to understand what we should do in *the future*.
Let's start with that.
:::

# Let's think about statistics.

# Statistics is all about estimating a population from a sample

## When we evaluate historical data, it's a snapshot in time

We think it's about finding "the truth," but what is "the population?"

{{< include _time-sample-population.qmd >}}

## All (Most) of Our Data Is Time-Series

It rarely looks *quite* like this.

::: {data-id="plot1"}
```{r base-ts}
#| dev.args: !expr 'list(bg="transparent")'

ggplot(get_ts(), aes(x = date, y = value)) +
  geom_line(color = s_line_1, linewidth = 1.1) +
  labs(y = "Sessions") +
  scale_y_continuous(expand = c(0,0), limits = ~ c(0, max(.x) * 1.1), label = comma) +
  theme_main

```
:::

## It often has a weekly cycle to it

This is "seasonality" that we'll get to in a bit.

::: {data-id="plot1"}
```{r trending}
#| dev.args: !expr 'list(bg="transparent")'

ggplot(get_ts(base = 10000, week_season = TRUE), aes(x = date, y = value)) +
  geom_line(color = s_line_1, linewidth = 1.1) +
  labs(y = "Sessions") +
  scale_y_continuous(expand = c(0,0), limits = ~ c(0, max(.x) * 1.1), label = comma) +
  theme_main

```
:::

## And it may have a trend to it

```{r}
#| dev.args: !expr 'list(bg="transparent")'

ggplot(get_ts(base = 50000, week_season = TRUE, trend = 0.5), aes(x = date, y = value)) +
  geom_line(color = s_line_1, linewidth = 1.1) +
  labs(y = "Sessions") +
  scale_y_continuous(expand = c(0,0), limits = ~ c(0, max(.x) * 1.1), label = comma) +
  theme_main
```

# "Time" is tricky.

# But it's at the core of what we do.

{{< include _stationarity.qmd >}}
{{< include _first-differences.qmd >}}
{{< include _time-series-decomposition.qmd >}}
{{< include _causal-impact.qmd >}}




